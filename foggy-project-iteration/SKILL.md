---
name: foggy-project-iteration
description: Foggy 项目迭代向导。分析项目当前状态，确定下一步工作，编排技能调用顺序。当用户开始新的开发迭代、询问下一步该做什么、或使用 /iterate 时使用。
---

# Foggy 项目迭代向导

分析 Foggy 项目当前状态，自动确定开发阶段，编排下一步工作并引导执行。

## 使用场景

当用户需要以下操作时使用：
- 开始新一轮开发迭代
- 询问"下一步该做什么"
- 项目状态检查和进度评估
- 新会话中恢复上次开发上下文

## 执行流程

### 1. 项目状态扫描

依次执行以下检查，建立项目全貌：

**基础信息**：
- 读取 `CLAUDE.md` 获取项目配置（技术栈、包名、端口、模型路径等）
- 读取 `pom.xml` 或 `package.json` 确认依赖版本

**数据模型层**：
- 检查 `sql/` 目录是否有 DDL 文件
- 扫描 TM 模型目录（从 CLAUDE.md 获取路径），统计已有 TM 文件数量
- 扫描 QM 模型目录，统计已有 QM 文件数量
- 读取 `application.yml` 检查 `model-list` 配置

**后端代码层**：
- 扫描 Controller 类数量和 API 端点
- 扫描 Service 类数量
- 扫描 DTO/Form 类数量
- 检查是否有测试代码

**前端代码层**：
- 检查 `frontend/` 目录是否存在
- 扫描 Vue 组件数量
- 检查是否有 foggy-data-viewer 配置
- 检查路由配置

**进度记录**：
- 读取 `docs/notes/` 下最近的进度笔记，了解上次迭代状态

### 2. 判断开发阶段

根据扫描结果，判断项目处于以下哪个阶段：

| 阶段 | 判定条件 | 下一步动作 |
|---|---|---|
| **S0 - 项目初始化** | 无 CLAUDE.md 或无 pom.xml/package.json | 引导初始化项目结构 |
| **S1 - 数据模型设计** | 有项目结构，无 DDL 文件 | 引导设计数据模型 |
| **S2 - TM 模型生成** | 有 DDL，TM 文件数 < DDL 表数 | 调用 `/tm-generate` |
| **S3 - QM 模型生成** | TM 完整，无 QM 文件 | 调用 `/qm-generate` |
| **S4 - 后端 API 开发** | QM 完整，无 Controller | 引导 API 开发 |
| **S5 - 前端开发** | 有后端 API，前端组件不足 | 调用 `/frontend-component-generator` |
| **S6 - 集成测试** | 前后端就绪，无测试 | 引导测试编写 |
| **S7 - 迭代增强** | 基础功能完整 | 分析待办清单，推荐优先项 |

### 3. 输出迭代计划

格式：

```
## 项目状态：{阶段名称}

### 已完成
- {已完成项1}
- {已完成项2}

### 当前阶段：{阶段描述}

建议执行以下步骤：

1. **{步骤1}** → 使用 `/{技能名}`
2. **{步骤2}** → 使用 `/{技能名}`
3. **{步骤3}** → 手动操作

### 依赖检查
- [ ] {前置条件1}（状态：✅/❌）
- [ ] {前置条件2}（状态：✅/❌）
```

### 4. 引导执行

- 按步骤顺序引导用户执行
- 每步完成后自动检查结果
- 遇到阻塞时提示解决方案
- 全部完成后建议生成进度笔记（`/xiaohongshu-note`）

## 技能调用链

标准开发迭代的技能调用顺序：

```
/tm-generate → /qm-generate → /backend-dsl-query → /form-design → /frontend-component-generator → /xiaohongshu-note
```

各环节说明：

| 顺序 | 技能 | 输入 | 输出 |
|---|---|---|---|
| 1 | `/tm-generate` | DDL 或表名 | TM 模型文件 |
| 2 | `/qm-generate` | TM 模型 | QM 查询模型 |
| 3 | `/backend-dsl-query` | QM 模型 | Service 层查询代码 |
| 4 | `/form-design` | API 需求 | Form/DTO 类 |
| 5 | `/frontend-component-generator` | QM 模型 | Vue 组件 |
| 6 | `/xiaohongshu-note` | 项目状态 | 进度笔记 |

## 增量迭代规则

当项目已有基础功能，进入增量迭代时：

- 如果用户新增了数据表 → 从 S2（TM 生成）开始
- 如果用户修改了表结构 → 更新对应 TM，然后级联更新 QM
- 如果用户要加新功能页面 → 从 S3（QM 生成）开始
- 如果用户要优化现有功能 → 直接进入 S7（迭代增强）

## 约束条件

- 不跳过阶段：TM 未完成不生成 QM，QM 未完成不生成前端组件
- 不替代具体技能：本技能只做编排和状态判断，实际生成工作交给对应技能
- 状态判断基于文件实际存在情况，不依赖用户口述
- 每次迭代结束建议生成进度笔记，保持项目文档持续更新

## 决策规则

- 如果是新会话且用户说"继续" → 先做项目状态扫描，恢复上下文
- 如果多个阶段都有缺口 → 按 S0-S7 顺序，优先处理最早的阶段
- 如果用户指定了要做的事 → 跳过自动判断，直接引导该任务
- 如果检测到 CLAUDE.md 中的 TODO 项 → 纳入迭代计划的待办清单
- 如果迭代完成 → 提醒生成进度笔记并更新 CLAUDE.md
